# Bluecoins Database Structure

`*.fydb` files generated by Bluecoins export are plain SQLite databases:

```sh
$ file Bluecoins_2022-03-19_00_57_22.fydb
Bluecoins_2022-03-19_00_57_22.fydb: SQLite 3.x database, user version 42, last written using SQLite version 3032002, file counter 11888, database pages 154, cookie 0x16, schema 4, largest root page 25, UTF-8, version-valid-for 11888
```

For example, transactions are stored in the `TRANSACTIONSTABLE` table. Columns relevant for the `convert` command are `transactionCurrency` and `conversionRateNew`:

```sql
SELECT transactionsTableID, conversionRateNew, transactionCurrency
FROM TRANSACTIONSTABLE
WHERE transactionCurrency != 'RUB'
LIMIT 5;
```

| transactionsTableID | conversionRateNew     | transactionCurrency |
|---------------------|----------------------|--------------------|
| 1589351855443       | 0.0112947956665299   | EUR                |
| 1589351896182       | 0.0125486150829316   | EUR                |
| 1589352019668       | 0.011549686321133    | EUR                |
| 1589352314955       | 0.0125486150829316   | EUR                |
| 1589352314956       | 0.0125486150829316   | EUR                |

Another example: select all categories and their groups:

```sql
SELECT G.categoryGroupID, G.parentCategoryName, C.childCategoryName
FROM CHILDCATEGORYTABLE C
JOIN PARENTCATEGORYTABLE G ON C.parentCategoryID = G.parentCategoryTableID
ORDER BY G.parentCategoryName, C.childCategoryName;
```

---

## Task: Archive Command to Move All Account Transactions to the Virtual Archive Account #6

### Archive

1. **Check**: `acc_old_balance == 0`
    - Where is account balance? (Check yourself)
2. **Check**: Account 'Archive' exists. If not, create it.

    ```sql
    -- Find account Archive
    SELECT * FROM ACCOUNTSTABLE WHERE accountName = 'Archive';

    -- Create account Archive
    INSERT INTO ACCOUNTSTABLE(accountName) VALUES('Archive');
    -- What about other columns in the table?
    ```

3. For all transactions: **add** labels `#cli_archive` and `#cli_%name_acc_old%` in `LABELSTABLE` with the next last ID.

    ```sql
    -- Find all transactions for Archive account:
    SELECT * FROM TRANSACTIONSTABLE WHERE accountID = ACCOUNTSTABLE.accountsTableID;

    -- Add transactions in LABELSTABLE
    INSERT INTO LABELSTABLE(labelName, transactionIDLabels)
    VALUES('cli_archive', /* TRANSACTIONSTABLE.transactionTableID */);
    -- Same with #cli_%name_acc_old%
    -- transactionIDLabels: ID from TRANSACTIONSTABLE
    ```

4. Move transactions to Archive account. `accountID == id_acc_archive`.

    ```sql
    -- Change accountID in transactions to Archive ID
    UPDATE TRANSACTIONSTABLE
    SET accountID = 1651056086581 -- ID Archive account
    WHERE accountID = 1593593417685; -- ID old account
    ```

5. **Delete** old account.

    ```sql
    -- Delete old account
    DELETE FROM ACCOUNTSTABLE WHERE accountsTableID = 1593593417685; -- ID old account
    ```

### Dearchive

1. **Check**: That account with name from tag `#clue_%name_archive_account%` exists. If not, create it.

---

## Hide from Account Selection and All Reports

**App:**

- Transaction tab: hide in filter
- Transaction tab: hide selected account transactions
- Create transaction page: hide from account list
- Main page: hide from reports

**DB:**

- `TRANSACTIONSTABLE`: no changes
- `ACCOUNTSTABLE`: `accountHidden = 1`

---

## Hide from Account Selection

**App:**

- Transaction tab: hide in filter
- Create transaction page: hide from account list

**DB:**

- `ACCOUNTSTABLE`: `accountSelectorVisibility = 1`

---

## Other Info about Bluecoins DB

*In backup, keep the language preference interface:*

- `SETTINGSTABLE` - 2 = %language%

**Tables:**

- `ACCOUNTSTABLE` - all created accounts
- `ACCOUNTTYPETABLE` - static info
